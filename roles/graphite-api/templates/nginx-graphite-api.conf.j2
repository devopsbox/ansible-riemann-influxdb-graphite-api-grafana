# This file was generated by Ansible for {{ ansible_fqdn }}
# Do NOT modify this file by hand!

server {
    listen {{graphite_api_nginx_port}};
    server_name {{graphite_api_nginx_host}};

    location / {
        include uwsgi_params;
        uwsgi_pass {{graphite_api_uwsgi_host}}:{{graphite_api_uwsgi_port}};

{% if graphite_api_nginx_allow_origin != "" %}
        add_header "Access-Control-Allow-Origin"      "{{graphite_api_nginx_allow_origin}}";
        add_header "Access-Control-Allow-Credentials" "true";
        add_header "Access-Control-Allow-Methods"     "GET, POST, OPTIONS";
        add_header "Access-Control-Allow-Headers"     "Authorization, origin, accept";
{% endif %}

        if ($request_method = 'OPTIONS' ) {
            # if request method is options we immediately return with 200 OK.
            return 200;
        }
    }
}
